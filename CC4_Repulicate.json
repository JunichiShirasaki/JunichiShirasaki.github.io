{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "width": 550,
  "height": 180,
  "title": {
    "text": "Blaming individuals for COVID-19 infection: agree vs disagree",
    "anchor": "start"
  },
  "data": {
    "values": [
      {"country": "UK", "group": "Disagree", "value": 96.52},
      {"country": "UK", "group": "Agree", "value": 3.48},
      {"country": "US", "group": "Disagree", "value": 95.25},
      {"country": "US", "group": "Agree", "value": 4.75},
      {"country": "Japan", "group": "Disagree", "value": 84.75},
      {"country": "Japan", "group": "Agree", "value": 15.25}
    ]
  },
  "transform": [
    {"calculate": "datum.value/100", "as": "p"},
    {"calculate": "format(datum.value, '.2f') + '%'", "as": "label"},
    {"calculate": "datum.group == 'Disagree' ? 0 : 1", "as": "grp_order"},
    {
      "stack": "p",
      "groupby": ["country"],
      "sort": [{"field": "grp_order", "order": "ascending"}],
      "as": ["x0", "x1"],
      "offset": "normalize"
    },
    {"filter": "datum.x1 >= 0.8"},
    {"calculate": "max(datum.x0, 0.8)", "as": "x0c"},
    {"calculate": "max(datum.x1, 0.8)", "as": "x1c"},
    {"calculate": "(datum.x0c + datum.x1c)/2", "as": "x_mid_c"}
  ],
  "layer": [
    {
      "mark": {"type": "bar", "clip": true},
      "encoding": {
        "y": {
          "field": "country",
          "type": "nominal",
          "sort": ["UK", "US", "Japan"],
          "axis": {"title": null}
        },
        "x": {
          "field": "x0c",
          "type": "quantitative",
          "scale": {"domain": [0.8, 1]},
          "axis": {
            "format": "%",
            "title": null,
            "values": [0.8, 0.85, 0.9, 0.95, 1]
          }
        },
        "x2": {"field": "x1c"},
        "color": {
          "field": "group",
          "type": "nominal",
          "scale": {
            "domain": ["Agree", "Disagree"],
            "range": ["#a6352a", "#2f4f6f"]
          },
          "legend": {"title": null, "values": ["Disagree", "Agree"]}
        }
      }
    },
    {
      "transform": [{"filter": "datum.group == 'Disagree'"}],
      "mark": {
        "type": "text",
        "baseline": "middle",
        "align": "center",
        "fontSize": 20,
        "color": "white"
      },
      "encoding": {
        "y": {
          "field": "country",
          "type": "nominal",
          "sort": ["UK", "US", "Japan"]
        },
        "x": {"field": "x_mid_c", "type": "quantitative"},
        "text": {"field": "label"}
      }
    },
    {
      "transform": [{"filter": "datum.group == 'Agree'"}],
      "mark": {
        "type": "text",
        "baseline": "middle",
        "align": "center",
        "fontSize": 20,
        "color": "white"
      },
      "encoding": {
        "y": {
          "field": "country",
          "type": "nominal",
          "sort": ["UK", "US", "Japan"]
        },
        "x": {"field": "x_mid_c", "type": "quantitative"},
        "text": {"field": "label"}
      }
    }
  ],
  "config": {}
}